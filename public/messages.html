<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Messages - Amplifi</title>
  <meta http-equiv="Cache-Control" content="no-store, must-revalidate">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="icon" type="image/svg+xml" href="icons/icon.svg">
  <link rel="apple-touch-icon" href="icons/icon-192x192.png">
  <link rel="manifest" href="manifest.json" onerror="console.warn('Manifest failed to load, but app will continue to work normally')">
  <meta name="theme-color" content="#1877f2">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Amplifi">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="stylesheet" href="base.css?v=13">
  <link rel="stylesheet" href="messages.css?v=13">
  <script src="version.js?v=13"></script>
  <style>
    /* iMessage-like Mobile Enhancements */
    @media (max-width: 768px) {
      .messages-container {
        height: calc(100vh - 140px) !important;
        min-height: auto !important;
      }
      
      .conversations-sidebar {
        background: #f8f9fa;
        border-right: none;
      }
      
      .conversation-item {
        padding: 12px 16px;
        border-bottom: 1px solid #e9ecef;
        background: white;
        margin: 0;
        border-radius: 0;
      }
      
      .conversation-item:hover {
        background: #f8f9fa;
      }
      
      .conversation-item.active {
        background: #e3f2fd;
        border-left: 4px solid #1877f2;
      }
      
      .messages-area {
        background: #f0f0f0;
      }
      
      .messages-main {
        background: #f0f0f0;
        padding: 8px 12px;
      }
      
      .message {
        max-width: 85%;
        margin-bottom: 8px;
        border-radius: 18px;
        padding: 8px 12px;
        position: relative;
        word-wrap: break-word;
      }
      
      .own-message {
        background: #007AFF;
        color: white;
        margin-left: auto;
        border-bottom-right-radius: 4px;
      }
      
      .other-message {
        background: #e5e5ea;
        color: #000;
        margin-right: auto;
        border-bottom-left-radius: 4px;
      }
      
      .message-form {
        background: white;
        border-top: 1px solid #e9ecef;
        padding: 12px 16px;
        position: sticky;
        bottom: 0;
      }
      
      .message-input-container {
        background: #f8f9fa;
        border-radius: 20px;
        border: 1px solid #e9ecef;
        padding: 8px 12px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      .message-input {
        border: none;
        background: transparent;
        flex: 1;
        padding: 8px 0;
        font-size: 16px;
        outline: none;
      }
      
      .send-btn {
        background: #007AFF;
        color: white;
        border: none;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        cursor: pointer;
        transition: background 0.2s;
      }
      
      .send-btn:hover {
        background: #0056b3;
      }
      
      .send-btn:disabled {
        background: #ccc;
        cursor: not-allowed;
      }
      
      .messages-header {
        background: white;
        border-bottom: 1px solid #e9ecef;
        padding: 12px 16px;
        display: flex;
        align-items: center;
        gap: 12px;
      }
      
      .back-btn {
        background: none;
        border: none;
        font-size: 18px;
        color: #007AFF;
        cursor: pointer;
        padding: 8px;
        border-radius: 50%;
        transition: background 0.2s;
      }
      
      .back-btn:hover {
        background: #f0f0f0;
      }
      
      .conversation-info {
        display: flex;
        align-items: center;
        gap: 12px;
        flex: 1;
      }
      
      .conversation-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
      }
      
      .conversation-details h4 {
        margin: 0;
        font-size: 16px;
        font-weight: 600;
        color: #000;
      }
      
      .conversation-status {
        font-size: 12px;
        color: #666;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header" role="banner">
    <div class="header-content">
      <div class="header-left">
        <h1 class="logo">Amplifi</h1>
      </div>
      <div class="header-center">
        <h2 class="page-title">Messages</h2>
      </div>
      <div class="header-actions">
        <button id="notificationBtn" class="btn btn-icon notification-btn" aria-label="Notifications" onclick="messagesPage.toggleNotificationDropdown()">
          <span class="notification-icon">üîî</span>
          <span id="notificationBadge" class="notification-badge" style="display: none;">0</span>
        </button>
        <div id="userMenu" class="user-menu" style="display: none;">
          <a href="profile.html" id="userAvatarLink" aria-label="Profile">
            <img id="userAvatar" src="default-avatar.svg" alt="User Avatar" class="user-avatar">
          </a>
          <div class="user-dropdown">
            <a href="settings.html">Settings</a>
            <a href="profile.html">Profile</a>
            <button onclick="messagesPage.handleLogout()">Logout</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Navigation Tabs -->
  <nav class="page-nav" role="navigation" aria-label="Main navigation">
    <a href="feed.html" class="nav-link">Feed</a>
    <a href="trending.html" class="nav-link">Trending</a>
    <a href="subscriptions.html" class="nav-link">Subscriptions</a>
    <a href="upload.html" class="nav-link">Upload</a>
    <a href="dashboard.html" class="nav-link">Dashboard</a>
    <a href="messages.html" class="nav-link active" aria-current="page">Messages</a>
    <a href="live.html" class="nav-link">Live</a>
    <a href="music-library.html" class="nav-link">üéµ Music</a>
    <a href="settings.html" class="nav-link">Settings</a>
  </nav>

  <!-- Messenger Layout -->
  <div class="main-layout">
    <main class="main-content" id="mainContent" tabindex="-1" role="main">
      <div class="messages-container" style="display: flex; height: 80vh; min-height: 500px;">
        <!-- Sidebar: People who sent you messages -->
        <aside class="conversations-sidebar show-mobile" aria-label="Conversations">
          <div class="conversations-header">
            <span class="sidebar-title">Conversations</span>
            <div class="conversations-actions">
              <button id="newConversationBtn" class="new-conversation-btn btn-icon" title="New Conversation" aria-label="New Conversation" onclick="messagesPage.showNewConversationModal()">Ôºã</button>
              <!-- Removed hardcoded New Group button to prevent duplicate -->
            </div>
          </div>
          <div class="conversations-search">
            <div class="search-input-wrapper" style="position: relative;">
              <span class="search-icon" style="position: absolute; left: 18px; top: 50%; transform: translateY(-50%);">üîç</span>
              <input type="text" id="conversationsSearch" placeholder="Search conversations..." autocomplete="off" style="padding-left: 2.2rem;" oninput="messagesPage.filterConversations(this.value)">
              <button class="clear-search" onclick="messagesPage.clearSearch()" style="display: none;">√ó</button>
            </div>
          </div>
          <div id="conversationsList" class="conversations-list" tabindex="0">
            <!-- Conversations will be loaded here -->
          </div>
        </aside>

        <!-- Draggable divider for resizing -->
        <div id="sidebar-resizer" class="sidebar-resizer" aria-label="Resize conversations sidebar" tabindex="0"></div>

        <!-- Main Chat Area: Conversation and chat box -->
        <section class="messages-area hide-mobile" aria-label="Chat">
          <!-- Chat Header with Back Button for Mobile -->
          <div class="messages-header" id="messagesHeader">
            <button class="back-btn" onclick="messagesPage.showSidebarMobile()" aria-label="Back">‚Üê</button>
            <div class="conversation-info">
              <img id="conversationAvatar" src="default-avatar.svg" alt="Conversation" class="conversation-avatar">
              <div class="conversation-details">
                <h4 id="conversationName">Conversation Name</h4>
                <span id="conversationStatus" class="conversation-status">Online</span>
              </div>
            </div>
            <div class="conversation-actions">
              <button class="btn-icon call-btn" onclick="messagesPage.startVoiceCall()" aria-label="Voice call" title="Voice call">üìû</button>
              <button class="btn-icon call-btn" onclick="messagesPage.startVideoCall()" aria-label="Video call" title="Video call">
                <!-- Modern camera SVG -->
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#1877f2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="15" height="10" rx="2"/><polygon points="17 11 22 7 22 17 17 13"/></svg>
              </button>
              <button class="btn-icon" onclick="messagesPage.showConversationOptions()" aria-label="More options">‚ãØ</button>
            </div>
          </div>

          <!-- Only one main chat search box -->
          <div class="search-input-wrapper" style="position: relative; margin: 1.2rem 0 0.5rem 0;">
            <span class="search-icon" style="position: absolute; left: 18px; top: 50%; transform: translateY(-50%);">üîç</span>
            <input type="text" class="search-messages-input" placeholder="Search messages..." style="padding-left: 2.2rem;">
          </div>

          <!-- Messages Scrollable Area -->
          <div class="messages-main" id="messagesMain">
            <div class="select-conversation-prompt">
              <div class="prompt-icon">üí¨</div>
              <h3>Select a conversation</h3>
              <p>Choose a conversation from the sidebar to start messaging</p>
            </div>
          </div>

          <!-- Input Bar: Only one set of icons, emoji picker placeholder -->
          <form id="messageForm" class="message-form">
            <div class="message-input-container">
              <!-- Removed hardcoded media, voice, and emoji buttons. Only input and send button remain. -->
              <div id="emoji-picker" style="display:none; position:absolute; bottom:60px; right:20px; z-index:1000;"></div>
              <input type="text" id="messageInput" placeholder="Type a message..." class="message-input" disabled>
              <button type="submit" class="send-btn" aria-label="Send message" disabled>‚û§</button>
            </div>
          </form>
        </section>
      </div>
    </main>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-storage-compat.js"></script>
  <script src="firebaseConfig.js?v=13"></script>
  <script src="js/utils.js?v=13"></script>
  <script src="js/messages.js?v=13"></script>
  <script src="app.js?v=13"></script>
</body>
</html> 